import{V as P,a as S,b as $,c as k,s as I,p as x,_ as F}from"./purify.es-2WhSts9N.js";import{c as T,g as H,n as p}from"./_plugin-vue2_normalizer-GTIfvTtm.js";import{A as D,a as M}from"./vue-apexcharts-trtDL0ol.js";var y={exports:{}};(function(e,t){(function(i,r){e.exports=r()})(T,function(){return function(i){function r(n){if(h[n])return h[n].exports;var o=h[n]={i:n,l:!1,exports:{}};return i[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var h={};return r.m=i,r.c=h,r.d=function(n,o,f){r.o(n,o)||Object.defineProperty(n,o,{configurable:!1,enumerable:!0,get:f})},r.n=function(n){var o=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(o,"a",o),o},r.o=function(n,o){return Object.prototype.hasOwnProperty.call(n,o)},r.p="",r(r.s=0)}([function(i,r,h){Object.defineProperty(r,"__esModule",{value:!0});var n=h(1);h.d(r,"Confetti",function(){return n.a}),r.default={install:function(o,f){this.installed||(this.installed=!0,o.prototype.$confetti=new n.a(f))}}},function(i,r,h){function n(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}var o=h(2),f=function(){function s(a,c){for(var l=0;l<c.length;l++){var d=c[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(a,c,l){return c&&s(a.prototype,c),l&&s(a,l),a}}(),u=function(){function s(){n(this,s),this.initialize(),this.onResizeCallback=this.updateDimensions.bind(this)}return f(s,[{key:"initialize",value:function(){this.canvas=null,this.ctx=null,this.W=0,this.H=0,this.particles={},this.droppedCount=0,this.particlesPerFrame=1.5,this.wind=0,this.windSpeed=1,this.windSpeedMax=1,this.windChange=.01,this.windPosCoef=.002,this.maxParticlesPerFrame=2,this.animationId=null}},{key:"createParticles",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.particles=new o.a({ctx:this.ctx,W:this.W,H:this.H,wind:this.wind,windPosCoef:this.windPosCoef,windSpeedMax:this.windSpeedMax,count:0,shape:a.shape||"circle",colors:{opts:a.colors||["DodgerBlue","OliveDrab","Gold","pink","SlateBlue","lightblue","Violet","PaleGreen","SteelBlue","SandyBrown","Chocolate","Crimson"],idx:0,step:10,get color(){return this.opts[(this.idx++/this.step|0)%this.opts.length]}}})}},{key:"createContext",value:function(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.style.display="block",this.canvas.style.position="fixed",this.canvas.style.pointerEvents="none",this.canvas.style.top=0,this.canvas.style.width="100vw",this.canvas.style.height="100vh",this.canvas.id="confetti-canvas",document.querySelector("body").appendChild(this.canvas)}},{key:"start",value:function(a){this.ctx||this.createContext(),this.animationId&&cancelAnimationFrame(this.animationId),this.createParticles(a),this.updateDimensions(),this.particlesPerFrame=this.maxParticlesPerFrame,this.animationId=requestAnimationFrame(this.mainLoop.bind(this)),window.addEventListener("resize",this.onResizeCallback)}},{key:"stop",value:function(){this.particlesPerFrame=0,window.removeEventListener("resize",this.onResizeCallback)}},{key:"remove",value:function(){this.stop(),this.animationId&&cancelAnimationFrame(this.animationId),this.canvas&&document.body.removeChild(this.canvas),this.initialize()}},{key:"updateDimensions",value:function(){this.W===window.innerWidth&&this.H===window.innerHeight||(this.W=this.particles.opts.W=this.canvas.width=window.innerWidth,this.H=this.particles.opts.H=this.canvas.height=window.innerHeight)}},{key:"mainLoop",value:function(a){for(this.updateDimensions(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.W,this.H),this.windSpeed=Math.sin(a/8e3)*this.windSpeedMax,this.wind=this.particles.opts.wind+=this.windChange;this.droppedCount<this.particlesPerFrame;)this.droppedCount+=1,this.particles.add();this.droppedCount-=this.particlesPerFrame,this.particles.update(),this.particles.draw(),this.particles.items.length&&(this.animationId=requestAnimationFrame(this.mainLoop.bind(this)))}}]),s}();r.a=u},function(i,r,h){function n(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}var o=h(3),f=function(){function s(a,c){for(var l=0;l<c.length;l++){var d=c[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(a,c,l){return c&&s(a.prototype,c),l&&s(a,l),a}}(),u=function(){function s(a){n(this,s),this.items=[],this.pool=[],this.opts=a}return f(s,[{key:"update",value:function(){for(var a=0;a<this.items.length;a++)this.items[a].update()===!0&&this.pool.push(this.items.splice(a--,1)[0])}},{key:"draw",value:function(){for(var a=0;a<this.items.length;a++)this.items[a].draw()}},{key:"add",value:function(){this.pool.length>0?this.items.push(this.pool.pop().setup(this.opts)):this.items.push(new o.a().setup(this.opts))}}]),s}();r.a=u},function(i,r,h){function n(u,s){if(!(u instanceof s))throw new TypeError("Cannot call a class as a function")}var o=function(){function u(s,a){for(var c=0;c<a.length;c++){var l=a[c];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}return function(s,a,c){return a&&u(s.prototype,a),c&&u(s,c),s}}(),f=function(){function u(){n(this,u)}return o(u,[{key:"setup",value:function(s){var a=s.ctx,c=s.W,l=s.H,d=s.colors,m=s.wind,v=s.windPosCoef,g=s.windSpeedMax,C=s.count,_=s.shape;return this.ctx=a,this.W=c,this.H=l,this.wind=m,this.shape=_,this.windPosCoef=v,this.windSpeedMax=g,this.x=this.rand(-35,c+35),this.y=this.rand(-30,-35),this.d=this.rand(150)+10,this.r=this.rand(10,30),this.color=d.color,this.tilt=this.randI(10),this.tiltAngleIncremental=(this.rand(.08)+.04)*(this.rand()<.5?-1:1),this.tiltAngle=0,this.angle=this.rand(2*Math.PI),this.count=C++,this}},{key:"randI",value:function(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s+(s=0);return Math.random()*(a-s)+s|0}},{key:"rand",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s+(s=0);return Math.random()*(a-s)+s}},{key:"update",value:function(){return this.tiltAngle+=this.tiltAngleIncremental*(.2*Math.cos(this.wind+(this.d+this.x+this.y)*this.windPosCoef)+1),this.y+=(Math.cos(this.angle+this.d)+3+this.r/2)/2,this.x+=Math.sin(this.angle),this.x+=Math.cos(this.wind+(this.d+this.x+this.y)*this.windPosCoef)*this.windSpeedMax,this.y+=Math.sin(this.wind+(this.d+this.x+this.y)*this.windPosCoef)*this.windSpeedMax,this.tilt=15*Math.sin(this.tiltAngle-this.count/3),this.y>this.H}},{key:"drawCircle",value:function(){this.ctx.arc(0,0,this.r/2,0,2*Math.PI,!1),this.ctx.fill()}},{key:"drawRect",value:function(){this.ctx.fillRect(0,0,this.r,this.r/2)}},{key:"drawHeart",value:function(){var s=this,a=function(c,l,d,m,v,g){s.ctx.bezierCurveTo(c/s.r*2,l/s.r*2,d/s.r*2,m/s.r*2,v/s.r*2,g/s.r*2)};this.ctx.moveTo(37.5/this.r,20/this.r),a(75,37,70,25,50,25),a(20,25,20,62.5,20,62.5),a(20,80,40,102,75,120),a(110,102,130,80,130,62.5),a(130,62.5,130,25,100,25),a(85,25,75,37,75,40),this.ctx.fill()}},{key:"draw",value:function(){this.ctx.fillStyle=this.color,this.ctx.beginPath(),this.ctx.setTransform(Math.cos(this.tiltAngle),Math.sin(this.tiltAngle),0,1,this.x,this.y),this.shape==="circle"?this.drawCircle():this.shape==="rect"?this.drawRect():this.shape==="heart"&&this.drawHeart()}}]),u}();r.a=f}])})})(y);var R=y.exports;const U=H(R),w=window.Vue;w.use(U);const A=w.extend({mounted:function(){this.$confetti.start({shape:"rect",colors:["DodgerBlue","OliveDrab","Gold","pink","SlateBlue","lightblue","Violet","PaleGreen","SteelBlue","SandyBrown","Chocolate","Crimson"]}),setTimeout(()=>{this.$confetti.stop()},5e3)},methods:{}});var V=function(){var t=this,i=t._self._c;return t._self._setupProxy,i("main")},L=[],N=p(A,V,L,!1,null,null,null,null);const O=N.exports,z=e=>e.map(function(t){return Math.max.apply(null,t)}),B=e=>({baseURL:e,headers:{"X-Requested-With":"XMLHttpRequest"}}),E=(e,t,i,r)=>{e.get(t,{params:i}).then(h=>{r&&r(h.data)}).catch(h=>{console.error(h)})},W={components:{apexcharts:D},props:{title:{type:String,default:""},subTitle:{type:String,default:""},range:{type:String,default:""},siteId:{type:Number,default:0},refreshIntervalSecs:{type:Number,default:3},apiUrl:{type:String,default:""}},data:function(){return{chartOptions:{chart:{id:"vuechart-dashboard",type:"area",height:160,sparkline:{enabled:!0}},colors:["#008FFB","#DCE6EC"],stroke:{curve:"straight",width:3},fill:{opacity:.2,gradient:{enabled:!0}},xaxis:{type:"category",labels:{show:!1,minHeight:"20px"},crosshairs:{width:1}},yaxis:{min:0},title:{text:this.title,offsetX:0,style:{fontSize:"24px",cssClass:"apexcharts-yaxis-title"}},subtitle:{text:this.subTitle,offsetX:0,style:{fontSize:"14px",cssClass:"apexcharts-yaxis-title"}}},series:[{name:"empty",data:[0]}]}},created(){this.getSeriesData()},mounted(){this.refreshIntervalSecs&&setInterval(()=>{this.getSeriesData()},this.refreshIntervalSecs*1e3)},methods:{getSeriesData:async function(){const e=M.create(B(this.apiUrl));await E(e,"",{range:this.range,siteId:this.siteId},t=>{if(t[0]!==void 0){const i=Math.round(z([t[0].data])[0]+1.5);this.chartOptions={...this.chartOptions,yaxis:{min:0,max:i,labels:{show:!1,minHeight:"20px"}},xaxis:{categories:t[0].labels,type:"category",labels:{show:!1,minHeight:"20px"},crosshairs:{width:1}},labels:t[0].labels},this.series=t}})}}};var j=function(){var t=this,i=t._self._c;return i("apexcharts",{attrs:{width:"100%",height:"200px",type:"area",options:t.chartOptions,series:t.series}})},q=[],G=p(W,j,q,!1,null,null,null,null);const X=G.exports,K=[{name:"__checkbox",titleClass:"center aligned",dataClass:"center aligned"},{name:"__component:file-not-found-url",sortField:"redirectSrcUrl",title:Craft.t("retour","404 File Not Found URL"),titleClass:"center vuetable-th-redirectSrcUrl",dataClass:"center vuetable-td-redirectSrcUrl"},{name:"referrerUrl",sortField:"referrerUrl",title:Craft.t("retour","Last Referrer URL"),titleClass:"center",dataClass:"center",callback:"urlFormatter"},{name:"remoteIp",sortField:"remoteIp",title:Craft.t("retour","Remote IP"),titleClass:"center",dataClass:"center",callback:"ipFormatter"},{name:"hitCount",sortField:"hitCount",title:Craft.t("retour","Hits"),titleClass:"text-right",dataClass:"text-right"},{name:"hitLastTime",sortField:"hitLastTime",title:Craft.t("retour","Last Hit"),titleClass:"center",dataClass:"center"},{name:"handledByRetour",sortField:"handledByRetour",title:Craft.t("retour","Handled"),titleClass:"text-center",dataClass:"text-center",callback:"boolFormatter"},{name:"addLink",sortField:"addLink",title:"",titleClass:"text-center",dataClass:"text-center",callback:"addUrlFormatter"}],J={props:{rowData:{type:Object,required:!0},rowIndex:{type:Number,default:0}},computed:{linkHref:function(){let e=this.rowData.redirectSrcUrl;return typeof e>"u"||e===""?"":(!new RegExp("^(?:[a-z]+:)?//","i").test(e)&&!e.includes("$")&&(e=e.replace(/^\//,""),e=Craft.getSiteUrl(e)),e)},linkTitle:function(){let e="";return e+="User Agent: "+this.rowData.userAgent+`

`,e+="Message: "+this.rowData.exceptionMessage+`

`,e+="File Path: "+this.rowData.exceptionFilePath+`

`,e+="Line No.: "+this.rowData.exceptionFileLine,e}}};var Q=function(){var t=this,i=t._self._c;return i("div",[i("a",{staticClass:"go",attrs:{href:t.linkHref,title:t.linkTitle}},[t._v(t._s(t.rowData.redirectSrcUrl))])])},Y=[],Z=p(J,Q,Y,!1,null,null,null,null);const tt=Z.exports,et=window.Vue;et.component("FileNotFoundUrl",tt);const it={components:{vuetable:P,"vuetable-pagination":S,"vuetable-pagination-info":$,"vuetable-filter-bar":k},mixins:[I],props:{siteId:{type:Number,default:0},refreshIntervalSecs:{type:Number,default:3},apiUrl:{type:String,default:""}},data:function(){return{moreParams:{siteId:this.siteId},css:{tableClass:"data fullwidth retour-dashboard",ascendingIcon:"icon retour-menubtn-asc",descendingIcon:"icon retour-menubtn-desc"},sortOrder:[{field:"hitCount",sortField:"hitCount",direction:"desc"}],fields:K,numSelected:0,perPage:20,selectedIds:[],retourHandled:"all",filterText:"",stringPerPage:Craft.t("retour","Per-page:"),stringDelete:Craft.t("retour","Delete"),stringStatistic:Craft.t("retour","statistic"),stringStatistics:Craft.t("retour","statistics")}},computed:{csrfTokenName:function(){return window.Craft.csrfTokenName},csrfTokenValue:function(){return window.Craft.csrfTokenValue}},watch:{retourHandled:function(){this.moreParams={siteId:this.siteId},this.moreParams={siteId:this.siteId,filter:this.filterText,handled:this.retourHandled},this.$events.fire("refresh-table",this.$refs.vuetable)},perPage:function(){this.$events.fire("refresh-table",this.$refs.vuetable)}},mounted(){this.$events.$on("filter-set",e=>this.onFilterSet(e)),this.$events.$on("filter-reset",()=>this.onFilterReset()),this.$refs.vuetable.$on("vuetable:checkbox-toggled",(e,t)=>this.onCheckboxToggled(e,t)),this.$refs.vuetable.$on("vuetable:checkbox-toggled-all",e=>this.onCheckboxToggled(e,null)),this.refreshIntervalSecs&&setInterval(()=>{typeof this.$refs.pagination<"u"&&this.$refs.pagination.isOnFirstPage&&typeof this.$refs.vuetable<"u"&&this.$refs.vuetable.refresh()},this.refreshIntervalSecs*1e3)},methods:{getSaveStateConfig(){return{cacheKey:"retour-dashboard-state-v2-"+Craft.username+Craft.siteId,ignoreProperties:["numSelected","selectedIds","moreParams"]}},onFilterSet(e){this.filterText=e,this.moreParams={filter:this.filterText,handled:this.retourHandled,siteId:this.siteId},this.$events.fire("refresh-table",this.$refs.vuetable)},onFilterReset(){this.filterText="",this.moreParams={filter:this.filterText,handled:this.retourHandled,siteId:this.siteId},this.$events.fire("refresh-table",this.$refs.vuetable)},onPaginationData(e){this.$refs.paginationTop.setPaginationData(e),this.$refs.paginationInfoTop.setPaginationData(e),this.$refs.pagination.setPaginationData(e),this.$refs.paginationInfo.setPaginationData(e)},onChangePage(e){this.$refs.vuetable.changePage(e)},onCheckboxToggled(){this.numSelected=0,this.selectedIds=[],this.$refs.vuetable!==void 0&&this.$refs.vuetable.selectedTo!==void 0&&(this.numSelected=this.$refs.vuetable.selectedTo.length,this.selectedIds=this.$refs.vuetable.selectedTo)},urlFormatter(e){return e===""?"":(e=x.sanitize(e),e=encodeURI(e),`
                <a class="go" href="${e}" title="${e}" target="_blank" rel="noopener">${e}</a>
                `)},ipFormatter(e){return e===""?"":(e=x.sanitize(e),e=encodeURI(e),`
                <a class="go" href="https://whatismyipaddress.com/ip/${e}" title="Lookup ${e}" target="_blank" rel="noopener">${e}</a>
                `)},boolFormatter(e){return e==1?`
                <span style="color: green;">&#x2714;</span>
                `:`
                <span style="color: red;">&#x2716;</span>
                `},addUrlFormatter(e){return e===""?"":`
                <a class="add icon" href="${e}" title="Add"></a>
                `}}};var st=function(){var t=this,i=t._self._c;return i("div",[i("div",{directives:[{name:"show",rawName:"v-show",value:t.numSelected!==0,expression:"numSelected !== 0"}]},[i("form",{attrs:{"accept-charset":"UTF-8",method:"post"}},[i("input",{attrs:{name:t.csrfTokenName,type:"hidden"},domProps:{value:t.csrfTokenValue}}),t._l(t.selectedIds,function(r){return i("input",{key:r,attrs:{name:"statisticIds[]",type:"hidden"},domProps:{value:r}})}),i("label",{staticClass:"text-gray-600"},[t._v(t._s(t.numSelected)+" "),t.numSelected===1?i("span",[t._v(t._s(t.stringStatistic))]):t._e(),t.numSelected!==1?i("span",[t._v(t._s(t.stringStatistics))]):t._e(),t._v(":")]),i("div",{staticClass:"btngroup inline"},[i("div",{staticClass:"ml-2 btn menubtn",attrs:{"data-icon":"settings"}}),i("div",{staticClass:"menu",attrs:{"data-align":"right"}},[i("ul",[i("li",[i("a",{staticClass:"formsubmit",attrs:{"data-action":"retour/statistics/delete-statistics"}},[t._v(t._s(t.stringDelete))])])])])])],2)]),i("vuetable-filter-bar",{directives:[{name:"show",rawName:"v-show",value:t.numSelected===0,expression:"numSelected === 0"}],attrs:{"initial-filter-text":t.filterText}}),i("div",{staticClass:"vuetable-pagination clearafter"},[i("vuetable-pagination-info",{ref:"paginationInfoTop"}),i("div",{staticClass:"floated left pl-3 pt-3 text-gray-600"},[i("div",{staticClass:"select"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.retourHandled,expression:"retourHandled"}],staticClass:"fieldtoggle",attrs:{"data-target-prefix":"retour-handled-",name:"retourHandled"},on:{change:function(r){var h=Array.prototype.filter.call(r.target.options,function(n){return n.selected}).map(function(n){var o="_value"in n?n._value:n.value;return o});t.retourHandled=r.target.multiple?h:h[0]}}},[i("option",{attrs:{selected:"",value:"all"}},[t._v(" All ")]),i("option",{attrs:{value:"handled"}},[t._v(" Handled ")]),i("option",{attrs:{value:"nothandled"}},[t._v(" Not Handled ")])])])]),i("vuetable-pagination",{ref:"paginationTop",on:{"vuetable-pagination:change-page":t.onChangePage}}),i("div",{staticClass:"floated left vuetable-pagination-info py-3"},[i("div",{staticClass:"inline pl-3 text-gray-600"},[t._v(" "+t._s(t.stringPerPage)+" ")]),i("div",{staticClass:"inline pl-3 text-gray-600"},[i("div",{staticClass:"select"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.perPage,expression:"perPage"}],staticClass:"fieldtoggle",attrs:{"data-target-prefix":"per-page-",name:"perPage"},on:{change:function(r){var h=Array.prototype.filter.call(r.target.options,function(n){return n.selected}).map(function(n){var o="_value"in n?n._value:n.value;return o});t.perPage=r.target.multiple?h:h[0]}}},[i("option",{attrs:{selected:"",value:"20"}},[t._v(" 20 ")]),i("option",{attrs:{value:"50"}},[t._v(" 50 ")]),i("option",{attrs:{value:"100"}},[t._v(" 100 ")]),i("option",{attrs:{value:"500"}},[t._v(" 500 ")])])])])])],1),i("vuetable",{ref:"vuetable",attrs:{"api-url":t.apiUrl,"append-params":t.moreParams,css:t.css,fields:t.fields,"per-page":t.perPage,"sort-order":t.sortOrder},on:{"vuetable:pagination-data":t.onPaginationData}}),i("div",{staticClass:"vuetable-pagination clearafter"},[i("vuetable-pagination-info",{ref:"paginationInfo"}),i("vuetable-pagination",{ref:"pagination",on:{"vuetable-pagination:change-page":t.onChangePage}})],1)],1)},at=[],nt=p(it,st,at,!1,null,null,null,null);const rt=nt.exports,b=window.Vue;b.use(F);new b({el:"#cp-nav-content",components:{ConfettiParty:O,DashboardChart:X,DashboardTable:rt},data:{},mounted(){this.$events.$on("refresh-table",e=>this.onTableRefresh(e))},methods:{onTableRefresh(e){b.nextTick(()=>e.refresh())}}});
//# sourceMappingURL=dashboard-ay4a9V8m.js.map
