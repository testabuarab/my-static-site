(()=>{var l={redactoranchorsModal:'<form action=""><div class="form-item"><label for="modal-redactoranchors-name">## anchor-name ##</label><input type="text" id="modal-redactoranchors-name" name="id"></div></form>'};var s={en:{anchor:"Anchor","anchor-add":"Add anchor","anchor-name":"Name"},de:{anchor:"Sprungmarke","anchor-add":"Sprungmarke setzen","anchor-name":"Name"},fr:{anchor:"Ancre","anchor-add":"Ajouter une ancre","anchor-name":"Nom"},es:{anchor:"Ancla","anchor-add":"Agregar ancla","anchor-name":"Nombre"}};function r(){!$R.modals.link||!$R.modules.link||$R.modals.link.search('id="modal-link-anchor"')>=1||($R.modals.link=$R.modals.link.replace("</form>",'<div class="form-item"><label for="modal-link-text">## anchor ##</label><input type="text" id="modal-link-anchor" name="anchor"></div></form>'),$Link=$R.modules.link,$Link.prototype._setLinkDataOrigin=$Link.prototype._setLinkData,$Link.prototype._setFormDataOrigin=$Link.prototype._setFormData,$Link.prototype._setLinkData=function(e,t,o){if(t.anchor){t.anchor="#"+t.anchor.replace("#","").trim();let n=t.url.indexOf("#");n>=0?t.url=t.url.slice(0,n)+t.anchor+t.url.slice(n):t.url+=t.anchor,t.url=t.url.replace(/#$/,"")}this._setLinkDataOrigin(e,t,o)},$Link.prototype._setFormData=function(e,t){this._setFormDataOrigin(e,t);let o=e.getData(),n=o.url.match(/^(?<url>.*?)(?<anchor>#(?!(entry|asset)\:[0-9]+).*?)(?<internal>#(entry|asset)\:[0-9]+.*)?$/i);n&&(o.url=n.groups.url+(n.groups.internal??""),o.anchor=n.groups.anchor.replace("#",""),e.setData(o))},$Link.prototype._validateData=function(e,t){return t.url.trim()===""&&(!t.anchor||t.anchor.trim()==="")?e.setError("url"):!0})}function a(e,t){if(!e){t.api("module.inline.remove",{attr:"id"});return}t.api("module.inline.format",{attr:{id:e},tag:"span"})}function i(e){let t=$R.dom(e.getInline());return t.attr("id")?t.attr("id"):c(e.isCollapsed()?t.text():e.getText())}function c(e){return e?e.substring(0,50).trim().toLowerCase().replace(/ /g,"-").replace(/[^a-z0-9-_.]/g,""):""}(function(e){e.add("plugin","redactoranchors",{modals:l,translations:s,init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.toolbar=t.toolbar,this.selection=t.selection,this.opts.stylesClass+=" redactoranchorsWrapper",r()},start:function(){this.toolbar.addButton("redactoranchors",{title:this.lang.get("anchor-add"),api:"plugin.redactoranchors.open"}).setIcon('<i class="re-icon-redactoranchors"></i>')},open:function(){this.app.api("module.modal.build",{name:"redactoranchorsModal",title:this.lang.get("anchor"),width:"440px",handle:"save",commands:{save:{title:this.lang.get("save")},cancel:{title:this.lang.get("cancel")}}})},onmodal:{redactoranchorsModal:{open:function(t,o){this.selection.isCollapsed()&&this.selection.setAll(this.selection.getElement()),this.selection.save(),o.setData({id:i(this.selection)})},opened:function(t,o){o.getField("id").focus()},save:function(t,o){let{id:n}=o.getData();if(n&&!n.match(/^[a-zA-Z][a-zA-Z0-9-_.]*$/gi))return o.setError("id"),!1;this.app.api("module.modal.close"),this.selection.restore(),a(n,this.app)}}}})})(Redactor);})();
